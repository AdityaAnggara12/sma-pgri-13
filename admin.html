<!DOCTYPE html>
<html>
<head>
  <title>Admin Pengumuman</title>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
</head>
<body>

<h2>Tambah Pengumuman</h2>

<input type="text" id="judul" placeholder="Judul"><br><br>
<textarea id="isi" placeholder="Isi pengumuman"></textarea><br><br>
<button onclick="publish()">Publish</button>

<script>
  const firebaseConfig = {
    apiKey: "ISI",
    authDomain: "ISI",
    projectId: "ISI",
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  function publish() {
    const judul = document.getElementById("judul").value;
    const isi = document.getElementById("isi").value;

    db.collection("pengumuman").add({
      judul: judul,
      isi: isi,
      tanggal: new Date()
    }).then(() => {
      alert("Berhasil Publish!");
      kirimNotif(judul, isi);
    });
  }

  function kirimNotif(judul, isi) {
    fetch("https://onesignal.com/api/v1/notifications", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Authorization": "Basic YOUR_REST_API_KEY"
      },
      body: JSON.stringify({
        app_id: "YOUR_APP_ID",
        included_segments: ["All"],
        headings: { en: judul },
        contents: { en: isi }
      })
    });
  }
</script>

</body>
</html>
